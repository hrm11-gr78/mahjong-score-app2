<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈõÄ„É≠„Ç∞</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#121212">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div id="app">
        <header>
            <h1>üÄÑ ÈõÄ„É≠„Ç∞</h1>
        </header>

        <nav>
            <button data-target="home" class="active">„Éõ„Éº„É†</button>
            <button data-target="users">„É¶„Éº„Ç∂„Éº</button>
            <button data-target="settings">Ë®≠ÂÆö</button>
        </nav>

        <main>
            <!-- HOME / SESSION SETUP SECTION -->
            <section id="home" class="active">
                <h2>Êñ∞Ë¶è„Çª„ÉÉ„Éà</h2>
                <form id="session-setup-form">
                    <div class="form-group">
                        <label>Êó•‰ªò</label>
                        <input type="date" id="session-date" required>
                    </div>
                    <div class="form-group">
                        <label>ÂØæÂ±ÄËÄÖ (4Âêç)</label>
                        <div class="score-grid">
                            <select name="p1" required class="user-select">
                                <option value="" disabled selected>ÈÅ∏Êäû...</option>
                            </select>
                            <select name="p2" required class="user-select">
                                <option value="" disabled selected>ÈÅ∏Êäû...</option>
                            </select>
                            <select name="p3" required class="user-select">
                                <option value="" disabled selected>ÈÅ∏Êäû...</option>
                            </select>
                            <select name="p4" required class="user-select">
                                <option value="" disabled selected>ÈÅ∏Êäû...</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <details>
                            <summary style="cursor:pointer; color:var(--primary-color); margin-bottom:10px;">„É´„Éº„É´Ë®≠ÂÆö
                                („Åì„ÅÆ„Çª„ÉÉ„Éà„ÅÆ„Åø)</summary>
                            <div style="padding: 10px; border: 1px solid #333; border-radius: 8px;">
                                <div class="form-group">
                                    <label>ÈÖçÁµ¶ÂéüÁÇπ</label>
                                    <input type="number" name="startScore" id="new-set-start" value="25000" step="100">
                                </div>
                                <div class="form-group">
                                    <label>Ëøî„ÅóÁÇπ</label>
                                    <input type="number" name="returnScore" id="new-set-return" value="30000"
                                        step="100">
                                </div>
                                <div class="form-group">
                                    <label>„Ç¶„Éû (1‰Ωç„Äú4‰Ωç)</label>
                                    <div class="score-grid" style="grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px;">
                                        <input type="number" name="uma1" id="new-set-uma1" value="30">
                                        <input type="number" name="uma2" id="new-set-uma2" value="10">
                                        <input type="number" name="uma3" id="new-set-uma3" value="-10">
                                        <input type="number" name="uma4" id="new-set-uma4" value="-30">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>ÂêåÁÇπÊôÇ„ÅÆÊâ±„ÅÑ</label>
                                    <div style="display: flex; gap: 20px; align-items: center;">
                                        <label
                                            style="display: flex; align-items: center; margin: 0; color: var(--text-primary);">
                                            <input type="radio" name="newSetTieBreaker" value="priority" checked
                                                style="width: auto; margin-right: 8px;"> Ëµ∑ÂÆ∂ÂÑ™ÂÖà
                                        </label>
                                        <label
                                            style="display: flex; align-items: center; margin: 0; color: var(--text-primary);">
                                            <input type="radio" name="newSetTieBreaker" value="split"
                                                style="width: auto; margin-right: 8px;"> Â±±ÂàÜ„Åë
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>
                    <button type="submit" class="btn-primary">„Çª„ÉÉ„ÉàÈñãÂßã</button>
                </form>

                <h2 class="mt-4">ÈÅéÂéª„ÅÆ„Çª„ÉÉ„Éà</h2>
                <div id="session-list">
                    <!-- Session list injected here -->
                </div>
            </section>

            <!-- SESSION DETAIL SECTION -->
            <section id="session-detail">
                <div class="history-header">
                    <button id="back-to-home" class="btn-secondary">‚Üê Êàª„Çã</button>
                    <span id="session-title" style="font-weight:bold;"></span>
                </div>

                <!-- Total Score Table -->
                <div class="history-card">
                    <h3>ÂêàË®à„Çπ„Ç≥„Ç¢</h3>
                    <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <label for="session-rate" style="margin: 0;">„É¨„Éº„Éà (ÁÇπ):</label>
                        <select id="session-rate" style="width: auto; padding: 5px;">
                            <option value="0">„Å™„Åó</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                    <div style="position: relative; height: 300px; width: 100%; margin-bottom: 20px;">
                        <canvas id="score-chart"></canvas>
                    </div>
                    <table class="history-table" id="session-total-table">
                        <!-- Totals injected here -->
                    </table>
                </div>

                <button id="new-game-btn" class="btn-primary" style="margin-bottom: 20px;">+ ÂØæÂ±Ä„ÇíËøΩÂä†</button>

                <h3>ÂØæÂ±ÄÂ±•Ê≠¥</h3>
                <div id="game-list">
                    <!-- Games injected here -->
                </div>
            </section>

            <!-- SCORE INPUT MODAL (Using Section for simplicity) -->
            <section id="input">
                <div class="history-header">
                    <button id="cancel-input" class="btn-secondary">„Ç≠„É£„É≥„Çª„É´</button>
                    <span>„Çπ„Ç≥„Ç¢ÂÖ•Âäõ</span>
                </div>
                <form id="score-form">
                    <div class="score-grid">
                        <!-- Player 1 -->
                        <div class="player-input">
                            <label id="lbl-p1">Player 1</label>
                            <input type="hidden" name="p1-name" id="inp-p1-name">
                            <div class="input-wrapper">
                                <input type="number" name="p1-score" placeholder="250" required>
                                <span class="suffix">00</span>
                            </div>
                        </div>
                        <!-- Player 2 -->
                        <div class="player-input">
                            <label id="lbl-p2">Player 2</label>
                            <input type="hidden" name="p2-name" id="inp-p2-name">
                            <div class="input-wrapper">
                                <input type="number" name="p2-score" placeholder="250" required>
                                <span class="suffix">00</span>
                            </div>
                        </div>
                        <!-- Player 3 -->
                        <div class="player-input">
                            <label id="lbl-p3">Player 3</label>
                            <input type="hidden" name="p3-name" id="inp-p3-name">
                            <div class="input-wrapper">
                                <input type="number" name="p3-score" placeholder="250" required>
                                <span class="suffix">00</span>
                            </div>
                        </div>
                        <!-- Player 4 -->
                        <div class="player-input">
                            <label id="lbl-p4">Player 4</label>
                            <input type="hidden" name="p4-name" id="inp-p4-name">
                            <div class="input-wrapper">
                                <input type="number" name="p4-score" placeholder="250" required>
                                <span class="suffix">00</span>
                            </div>
                        </div>
                    </div>

                    <div class="total-check" id="total-check">ÂêàË®à: 0</div>

                    <button type="submit" class="btn-primary">Ë®àÁÆó„Åó„Å¶‰øùÂ≠ò</button>
                </form>
            </section>

            <!-- SETTINGS SECTION -->
            <section id="settings">
                <h2>„É´„Éº„É´Ë®≠ÂÆö</h2>
                <form id="settings-form">
                    <div class="form-group">
                        <label>ÈÖçÁµ¶ÂéüÁÇπ</label>
                        <input type="number" id="set-start" value="25000" step="100">
                    </div>
                    <div class="form-group">
                        <label>Ëøî„ÅóÁÇπ</label>
                        <input type="number" id="set-return" value="30000" step="100">
                    </div>
                    <div class="form-group">
                        <label>„Ç¶„Éû (1‰Ωç„Äú4‰Ωç)</label>
                        <div class="score-grid" style="grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px;">
                            <input type="number" id="set-uma1" value="30">
                            <input type="number" id="set-uma2" value="10">
                            <input type="number" id="set-uma3" value="-10">
                            <input type="number" id="set-uma4" value="-30">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ÂêåÁÇπÊôÇ„ÅÆÊâ±„ÅÑ</label>
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <label style="display: flex; align-items: center; margin: 0; color: var(--text-primary);">
                                <input type="radio" name="tieBreaker" value="priority" checked
                                    style="width: auto; margin-right: 8px;"> Ëµ∑ÂÆ∂ÂÑ™ÂÖà
                            </label>
                            <label style="display: flex; align-items: center; margin: 0; color: var(--text-primary);">
                                <input type="radio" name="tieBreaker" value="split"
                                    style="width: auto; margin-right: 8px;"> Â±±ÂàÜ„Åë
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Ë®≠ÂÆö„Çí‰øùÂ≠ò</button>
                    <button type="button" id="reset-settings" class="btn-danger"
                        style="margin-top:10px;">ÂàùÊúüÂÄ§„Å´Êàª„Åô</button>
                </form>
            </section>

            <!-- USERS SECTION -->
            <section id="users">
                <h2>„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ</h2>
                <div class="form-group">
                    <input type="text" id="new-user-name" placeholder="ÂêçÂâç„ÇíÂÖ•Âäõ...">
                </div>
                <button id="add-user-btn" class="btn-primary" style="margin-bottom: 20px;">„É¶„Éº„Ç∂„ÉºËøΩÂä†</button>

                <h3>ÁôªÈå≤„É¶„Éº„Ç∂„Éº</h3>
                <ul id="user-list" class="user-list">
                    <!-- Users will be injected here -->
                </ul>
            </section>

            <!-- USER DETAIL SECTION -->
            <section id="user-detail">
                <div class="history-header">
                    <button id="back-to-users" class="btn-secondary">‚Üê Êàª„Çã</button>
                    <span id="user-detail-name" style="font-weight:bold;"></span>
                </div>

                <div id="cumulative-score-card" class="history-card"
                    style="text-align: center; padding: 40px 30px; margin-bottom: 25px; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); border: 2px solid #475569; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); position: relative; overflow: hidden;">
                    <!-- Background decoration -->
                    <div
                        style="position: absolute; top: -50%; right: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, transparent 70%); pointer-events: none;">
                    </div>

                    <div style="position: relative; z-index: 1;">
                        <div
                            style="font-size: 1rem; color: #e2e8f0; margin-bottom: 16px; letter-spacing: 1px; text-transform: uppercase; font-weight: 600; padding: 8px 20px; border: 2px solid rgba(226, 232, 240, 0.3); border-radius: 20px; display: inline-block;">
                            Á¥ØË®à„Çπ„Ç≥„Ç¢</div>

                        <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                            <div id="score-icon"
                                style="font-size: 2.5rem; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));">üéØ</div>
                            <div
                                style="font-size: 4rem; font-weight: 800; line-height: 1; text-shadow: 0 4px 12px rgba(0,0,0,0.4);">
                                <span id="user-total-score">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="history-card">
                    <h3>„Çª„ÉÉ„ÉàÂ±•Ê≠¥</h3>
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Êó•‰ªò</th>
                                <th>„Çπ„Ç≥„Ç¢</th>
                            </tr>
                        </thead>
                        <tbody id="user-history-list">
                            <!-- History injected here -->
                        </tbody>
                    </table>
                    <div id="tie-breaker-options">
                        <!-- Options injected here -->
                    </div>
                </div>
    </div>

    <script src="js/mahjong.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    }, (err) => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>

</html>